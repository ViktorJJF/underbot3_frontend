import{d as ne,l as A,m as ue,u as ie,b as de,r as n,e as D,q as H,s as re,G as ce,H as _e,I as G,f as _,o as r,c,h as e,x as i,t as o,i as l,w as a,g as M,J as pe,K as ve,v as me,L as he,F as be,B as fe,p as ge,k as we,_ as ke}from"./index-7e64b160.js";const d=k=>(ge("data-v-ede94c3f"),k=k(),we(),k),ye={class:"row"},Te={class:"col-12"},Ve={class:"card box-margin"},Le={class:"card-body"},xe={key:0,class:"row"},Ce=d(()=>e("h3",null,"Bot no existe",-1)),Be=[Ce],De={key:1,class:"row"},$e={class:"col-xs-12 col-sm-8"},Ie=d(()=>e("b",null,"Bot ",-1)),Se=d(()=>e("b",null,"Bot ID Databot: ",-1)),Re=d(()=>e("b",null,"assistant_id: ",-1)),Ae=d(()=>e("b",null,"Sesi贸n actual: ",-1)),Me=d(()=>e("b",null,"Modelo: ",-1)),Pe={class:"mt-3"},qe=d(()=>e("h5",null,"Solicitudes API LLM",-1)),Ee={key:0,class:"badge badge-soft-success"},Ne={key:1,class:"badge badge-soft-warning"},Ue={key:2,class:"badge badge-soft-danger"},Oe={key:0,class:"col-xs-12 col-sm-4"},Ke={class:"preview"},je=["src"],ze={key:1,class:"col-xs-12 col-sm-4"},Fe=["src"],He=["href"],Ge=d(()=>e("h5",null,"Consumo de tokens: ",-1)),Je={class:"mb-3"},Qe={class:""},We=d(()=>e("h5",null,"Variables de entrada",-1)),Xe=d(()=>e("br",null,null,-1)),Ye=d(()=>e("div",{class:""},[e("h5",null,"Prompt")],-1)),Ze=d(()=>e("div",{class:""},[e("h5",null,"Respuesta")],-1)),et={class:"dialog-footer"},tt=ne({__name:"PlaygroundView",setup(k){A("$formatDate"),A("$deepCopy");const J=A("$uuid"),y=ue(),P=ie();de();let h;const T=n({}),V=n({}),p=n(""),b=n(0),f=n(0),Q=n(0),g=n([]),v=n({}),q=n([]),E=n("gpt-3.5-turbo-0301"),L=n(!0),$=n(!1);n(null);const N=n(0),w=n(!1),I=n(""),x=n(""),U=D(()=>P.query.assistant_id),W=D(()=>window.location.pathname),X=D(()=>window.location.hostname),Y=D(()=>U.value.split("").reverse().join(""));H(g,()=>{g.value.length===0&&j()}),H(P,u=>{j(),u.fullPath.includes("recommender")?(I.value="recommender",p.value=J()):I.value="bot"},{deep:!0,immediate:!0}),re(()=>{Z(),h&&window.removeEventListener("message",h),h=u=>{const{event:s,payload:C}=u.data;s==="message_sent"&&(console.log("BOT TERMINO DE ESCRIBIR...",C),p.value=C.session_id,O(p.value),K(p.value))},window.addEventListener("message",h)}),ce(()=>{h&&window.removeEventListener("message",h)});async function Z(){T.value=await y.dispatch("assistantsModule/listOne",U.value),ee(1954)}async function ee(u){_e.get(G.DATABOT_DASHBOARD_BACKEND_URL+`/get_bot_info/${u}`).then(s=>{V.value=s.data})}async function O(u){const s=await y.dispatch("llmTrackerModule/getTotalTokens",{by:"session",session_id:u});s.ok&&(console.log(" Aqui *** -> TOKEN USAGE:",s),b.value=s.payload.prompt_tokens,f.value=s.payload.completion_tokens)}async function K(u){g.value=await y.dispatch("llmTrackerModule/list",{session_id:u})}function j(){g.value=[],v.value={},w.value=!1,b.value=0,f.value=0,Q.value=0}async function z(){if(x.value.length>0){$.value=!0;const u=await y.dispatch("productsModule/search",{query:x.value,session_id:p.value,useLlm:L.value});q.value=u.payload,O(p.value),K(p.value),$.value=!1}}return(u,s)=>{const C=_("el-option"),te=_("el-select"),m=_("el-table-column"),B=_("el-button"),F=_("el-table"),le=_("el-input"),se=_("el-checkbox"),S=_("el-card"),ae=_("el-form"),oe=_("el-dialog");return r(),c("div",ye,[e("div",Te,[e("div",Ve,[e("div",Le,[V.value?(r(),c("div",De,[e("div",$e,[e("div",null,[Ie,i(" "+o(T.value.name),1)]),e("div",null,[Se,i(" "+o(T.value.bot_id),1)]),e("div",null,[Re,i(" "+o(T.value.assistant_id),1)]),e("div",null,[Ae,i(" "+o(p.value),1)]),e("div",null,[Me,i(" "+o(p.value),1)]),l(te,{modelValue:E.value,"onUpdate:modelValue":s[0]||(s[0]=t=>E.value=t),disabled:"",placeholder:"Modelo"},{default:a(()=>[l(C,{label:"gpt-3.5-turbo-0301",value:"gpt-3.5-turbo-0301",disabled:!0})]),_:1},8,["modelValue"]),e("div",Pe,[e("h5",null,"Prompt tokens: "+o(b.value),1)]),e("div",null,[e("h5",null,"Completion tokens: "+o(f.value),1)]),e("div",null,[e("h5",null,"Total para sesi贸n activa: "+o(b.value+f.value),1)]),e("div",null,[e("h5",null,"Costo para sesi贸n activa: "+o(((b.value+f.value)/1e3*.002).toFixed(4))+" usd ",1)]),qe,l(F,{data:g.value,style:{width:"100%"}},{default:a(()=>[l(m,{prop:"is_stream",label:"Stream?",width:"180"}),l(m,{prop:"status_request",label:"C贸digo Respuesta",width:"180"},{default:a(t=>[t.row.status_request==="200"?(r(),c("span",Ee,"200 OK")):M("v-if",!0),t.row.status_request==="408"?(r(),c("span",Ne,"408 Timeout")):M("v-if",!0),t.row.status_request==="500"?(r(),c("span",Ue,"500 Error")):M("v-if",!0)]),_:1}),l(m,{prop:"response_time",label:"Tiempo respuesta(segs)",width:"180"},{default:a(t=>[e("ul",null,[e("li",null,o(t.row.response_time),1),pe(e("li",null,o(t.row.response_time_before_stream)+" antes de stream ",513),[[ve,t.row.is_stream]])])]),_:1}),l(m,{prop:"total_tokens",label:"Tokens"}),l(m,{prop:"response",label:"Detalle"},{default:a(t=>[l(B,{size:"small",type:"primary",onClick:R=>{v.value=t.row,w.value=!0}},{default:a(()=>[i("Ver detalle")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),I.value==="bot"?(r(),c("div",Oe,[l(B,{size:"small",type:"primary",onClick:s[1]||(s[1]=t=>N.value+=1)},{default:a(()=>[i("Recargar iframe bot")]),_:1}),e("div",Ke,[(r(),c("iframe",{key:N.value,class:"expand",src:`${me(G).DATABOT_BOT_URL}/bot?id=${V.value.id}&token=${V.value.token}&clientPathName=${W.value}&clientHostName=${X.value}&isPlayground=true&assistant_id=${Y.value}`},null,8,je))])])):(r(),c("div",ze,[l(le,{class:"mb-2",modelValue:x.value,"onUpdate:modelValue":s[2]||(s[2]=t=>x.value=t),placeholder:"B煤squeda para recomendaci贸n",clearable:"",onKeyup:he(z,["enter"])},null,8,["modelValue","onKeyup"]),l(B,{type:"primary",onClick:z,loading:$.value},{default:a(()=>[i("Buscar")]),_:1},8,["loading"]),l(se,{class:"ml-3",modelValue:L.value,"onUpdate:modelValue":s[3]||(s[3]=t=>L.value=t)},{default:a(()=>[i(o(L.value?"Usar LLM para b煤squeda":"Sin LLM"),1)]),_:1},8,["modelValue"]),l(F,{data:q.value,stripe:"",style:{width:"100%"}},{default:a(()=>[l(m,{label:"Imagen",prop:"image_url"},{default:a(t=>[e("img",{src:t.row.image_url,alt:"Imagen",width:"100",height:"100"},null,8,Fe)]),_:1}),l(m,{label:"Nombre",prop:"name"},{default:a(t=>[e("span",null,o(t.row.name),1),i(" link "),e("div",null,[e("a",{href:t.row.product_url,target:"_blank"},"Ver",8,He)])]),_:1}),l(m,{label:"Categor铆as",prop:"categories"}),l(m,{label:"Disponible",prop:"available"})]),_:1},8,["data"])]))])):(r(),c("div",xe,Be))])])]),l(oe,{modelValue:w.value,"onUpdate:modelValue":s[5]||(s[5]=t=>w.value=t),title:"Detalles de solicitud a LLM "+(v.value.is_stream?"(Solicitud stream final)":"(Solicitud intermedia)"),width:"50%"},{footer:a(()=>[e("span",et,[l(B,{type:"success",onClick:s[4]||(s[4]=t=>w.value=!1)},{default:a(()=>[i(" Listo ")]),_:1})])]),default:a(()=>[l(ae,{"label-position":"top","label-width":"100px"},{default:a(()=>[Ge,e("ul",Je,[e("li",null,"prompt_tokens: "+o(v.value.prompt_tokens),1),e("li",null,"completion_tokens: "+o(v.value.completion_tokens),1),e("li",null,"Total: "+o(v.value.total_tokens),1)]),l(S,{shadow:"never",class:"box-card mb-2"},{header:a(()=>[e("div",Qe,[We,e("ul",null,[(r(!0),c(be,null,fe(v.value.input_variables,(t,R)=>(r(),c("li",{key:R},[e("b",null,"- "+o(R),1),i(":"),Xe,e("pre",null,o(t),1)]))),128))])])]),_:1}),l(S,{shadow:"never",class:"box-card mb-2"},{header:a(()=>[Ye]),default:a(()=>[e("pre",null,o(v.value.prompt),1)]),_:1}),l(S,{shadow:"never",class:"box-card mb-2"},{header:a(()=>[Ze]),default:a(()=>[e("pre",null,o(v.value.response),1)]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});const at=ke(tt,[["__scopeId","data-v-ede94c3f"],["__file","D:/Programacion/Trabajo/Databot/vue3_ts_skeleton/src/views/PlaygroundView.vue"]]);export{at as default};
