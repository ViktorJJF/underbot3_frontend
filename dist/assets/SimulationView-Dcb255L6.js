import{d as xe,r,f as Fe,c as de,y as Te,h as ke,B as Ae,P as ce,Q as Me,R as E,k as D,o as m,a as U,b as t,e as v,p as b,F as H,l as L,u as ee,w as Pe,A as Se,t as s,q as k,z as R,n as te,s as Ne,C as Qe,D as Ie}from"./index-DHr_EMP0.js";import{s as me}from"./subDays-CGrVKdv9.js";const $e={class:"container"},Ee={class:"row my-3"},qe={class:"col-sm-3"},Oe={class:"col-sm-3"},ze={class:"col-sm-3"},He={class:"col-sm-3"},Le={class:"row"},Re={class:"row"},We={class:"col-sm-6"},Ge={class:"match-ended"},je={class:"d-inline"},Je={class:"col-sm-6"},Ke={class:"col-sm-4"},Xe={class:"table"},Ye={scope:"row"},Ze=["href"],st=xe({__name:"SimulationView",setup(be){const A=r([]),W=r(new Date(me(new Date,1))),G=r(new Date(me(new Date,1))),j=r(new Date("2023-10-26")),q=r(null),J=r(!1),M=r(0),O=r(0),ae=r(0),le=r(0),P=r([]);r({});const w=r({wins:0,losses:0,winrate:0}),g=r({wins:0,losses:0,winrate:0}),se=r(0),p=r({fromQuarter:[!0,"c4","Evaluar desde","text"],untilQuarter:[!0,"c4","Evaluar hasta","text"],fromTime:[!0,12*60*1e3,"Desde (milisegundos) (Faltando 2 min para acabar c3) ","number"],untilTime:[!0,5*60*1e3,"Hasta (milisegundos) (Antes de llegar al minuto 5 de c4)","number"],minUnderPercent:[!1,80,"Mínimo porcentaje de Under","number"],hasUnderBeatOver:[!1,!1,"Under supera o iguala over","boolean"],minimalScoreDifference:[!1,8,"Mínima diferencia de score (pendiente) (NEW)","number"],minimalUpsDownsDifference:[!0,.1,"Mínima diferencia de Ups/Downs %","number"],hasInvertedCones:[!0,!0,"Evaluar gráfica en forma de montañas","boolean"],minimalDifferenceToNextBet:[!0,2,"Mínima diferencia para apostar de nuevo en mismo match","number"],moneyBet:[!0,333,"Dinero a apostar (Primera apuesta cebo)","number"],moneyNextBet:[!0,533,"Dinero a apostar (Siguientes apuestas)","number"],ignoreFirstBet:[!1,!0,"Ignorar primera apuesta","boolean"]}),x=Fe(),ve=de(()=>P.value),f=de(()=>p.value.ignoreFirstBet[0]&&p.value.ignoreFirstBet[1]?P.value.filter(l=>!l.isFirstBet):ve.value);Te(p,()=>{clearTimeout(le.value),le.value=setTimeout(()=>{ne()},500)},{deep:!0}),ke(async()=>{await S()});async function S(){const l={sort:"createdAt",order:"desc",dateFrom:W.value,dateTo:G.value,dateBoth:j.value};q.value&&(l.teamId=q.value),await Promise.all([x.dispatch("matchesModule/list",l),x.dispatch("teamsModule/list",{sort:"name",order:"asc",league:"NBA"})]),A.value=x.state.matchesModule.matches,A.value=A.value.map(e=>({...e,unders:Ae(e.odds)})),console.log("🐞 LOG HERE matches.value:",A.value.length),ne()}async function ne(){J.value=!0,ye(),await pe(),De(),J.value=!1}async function pe(){for(const l of A.value)await fe(l);we(f.value)}async function fe(l){l.externalId;let e={},h,d=[],i={},y=!1,B=!0;const N=l.unders.filter(n=>n.quarter!=="c4");let F=[];const{fromQuarter:C,untilQuarter:a,fromTime:c,untilTime:u,minUnderPercent:ie,hasUnderBeatOver:ue,minimalScoreDifference:et,minimalUpsDownsDifference:z,hasInvertedCones:Q,moneyBet:Be,moneyNextBet:Ce,minimalDifferenceToNextBet:re}=p.value;Q[0]&&Q[1]&&(d=ce(l.unders.filter(n=>n.quarter!="c4"),l.teams.some(n=>_(n.name))?9:12),console.log("🐞 LOG HERE invertedCones:",d)),(z[0]||z[0]&&z[1])&&(i=Me(N),console.log("Ups downs: ",i.upsCounterPercent,i.downsCounterPercent,i.upsCounterPercent-i.downsCounterPercent),i.upsCounterPercent-i.downsCounterPercent>=parseFloat(z[1])&&(y=!0));for(const n of l.unders)if(F.push(n),n.quarter=="c4"&&(!l.teams.some(V=>_(V.name))||l.teams.some(V=>_(V.name))&&n.millis&&n.millis!=0&&n.millis<7*60*1e3)){l.teams.some(o=>_(o.name))&&n.millis&&n.millis!=0&&n.millis<7*60*1e3&&(d=ce(F,(l.teams.some(o=>_(o.name)),12)));const V=n.value,I=n.quarter,$=n.millis,K=n.underQuota,X=n.overQuota,Ve=n.scores;let Y=parseInt(I[1].match(/\d+/)[0]);const Ue=[{isActive:C[0]&&a[0],condition:Y&&Y>=C[1].match(/\d+/)[0]&&Y<=a[1].match(/\d+/)[0]},{isActive:c[0]&&u[0],condition:(I==C[1]?$<=parseInt(c[1]):!0)&&(I==a[1]?$>=parseInt(u[1]):!0)||I=="c4"&&($===0||!$)},{isActive:ie[0],condition:e.underPercent&&e.underPercent>=parseFloat(ie[1])},{isActive:ue[0],condition:ue[1]?K>=X:K<=X},{isActive:Q[0],condition:Q[0]&&Q[1]?d.length==0:!0}];let T=P.value.filter(o=>o.matchId==l._id);if(i.upsCounterPercent-i.downsCounterPercent>=.24||(y||l.teams.some(o=>_(o.name)))&&T.length>0||l.teams.every(o=>_(o.name))||l.teams.some(o=>ge(o.name))&&T.length>2)return;if(!T.find(o=>o.matchId===l._id&&o.type==="U"&&o.score===V)){let o=T[T.length-1];(!o||o&&o.value<=V-(re[0]?parseInt(re[1]):2))&&Ue.filter(Z=>Z.isActive).every((Z,tt)=>Z.condition)&&(he(l,V,"U",$,I,K,X,Ve||[],h,d.length?d.length:0,i?i.upsCounterPercent-i.downsCounterPercent:0,T.length==0?Be[1]:Ce[1],B),B&&(B=!1))}}}function he(l,e,h,d,i,y,B,N,F,C,a,c,u){P.value.push({matchId:l._id,value:e,type:h,millis:d,quarter:i,underQuota:y,overQuota:B,scores:N,historicalUnder:F,match:l,invertedConesLength:C,upsDownsDifference:a,money:c,isFirstBet:u})}function we(l){l.forEach((e,h)=>{e.type==="U"?e.value>e.match.scoresDetailed.home+e.match.scoresDetailed.away?(w.value.wins++,l[h].win=!0):(w.value.losses++,l[h].win=!1):e.value<e.match.scoresDetailed.home+e.match.scoresDetailed.away?g.value.wins++:g.value.losses++}),w.value.winrate=E(w.value.wins/f.value.length),g.value.winrate=E(g.value.wins/f.value.length),se.value=E((w.value.wins+g.value.wins)/f.value.length)}function ye(){P.value=[],w.value.wins=0,w.value.losses=0,g.value.wins=0,g.value.losses=0}function De(){p.value.moneyBet[1]=parseFloat(p.value.moneyBet[1]),p.value.moneyNextBet[1]=parseFloat(p.value.moneyNextBet[1]),M.value=f.value.reduce((l,e)=>l+parseFloat(e.money),0),O.value=E(f.value.reduce((l,e)=>((e.type==="U"&&e.value>e.match.scoresDetailed.home+e.match.scoresDetailed.away||e.type==="O"&&e.value<e.match.scoresDetailed.home+e.match.scoresDetailed.away)&&(l+=(e.underQuota||1.63)*parseFloat(e.money)),l),0)),ae.value=E((O.value-M.value)/M.value)}function _(l){return[].includes(l)}function ge(l){return[].includes(l)}function _e(){window.open("/simulations-teams?");for(const l of x.state.teamsModule.teams)x.commit("simulationsModule/addSimulation",l)}function oe(l){return l.type==="U"&&l.value>l.match.scoresDetailed.home+l.match.scoresDetailed.away||l.type==="O"&&l.value<l.match.scoresDetailed.home+l.match.scoresDetailed.away}return(l,e)=>{const h=D("el-option"),d=D("el-select"),i=D("el-date-picker"),y=D("el-divider"),B=D("el-checkbox"),N=D("el-switch"),F=D("el-input"),C=D("el-button");return m(),U("div",null,[t("div",$e,[t("div",Ee,[t("div",qe,[v(d,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=a=>q.value=a),placeholder:"Filtrar equipo",onChange:S,clearable:""},{default:b(()=>[(m(!0),U(H,null,L(ee(x).state.teamsModule.teams,(a,c)=>(m(),R(h,{key:c,label:a.name,value:a._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",Oe,[e[4]||(e[4]=t("span",{class:""},"Desde",-1)),v(i,{onChange:S,class:"mx-2",modelValue:W.value,"onUpdate:modelValue":e[1]||(e[1]=a=>W.value=a),type:"date",placeholder:"Desde",size:"large"},null,8,["modelValue"])]),t("div",ze,[e[5]||(e[5]=t("span",{class:""},"Hasta",-1)),v(i,{onChange:S,class:"mx-2",modelValue:G.value,"onUpdate:modelValue":e[2]||(e[2]=a=>G.value=a),type:"date",placeholder:"Hasta",size:"large"},null,8,["modelValue"])]),t("div",He,[e[6]||(e[6]=t("span",{class:""},"Ambos",-1)),v(i,{onChange:S,class:"mx-2",modelValue:j.value,"onUpdate:modelValue":e[3]||(e[3]=a=>j.value=a),type:"date",placeholder:"Ambos",size:"large"},null,8,["modelValue"])])]),v(y),t("div",Le,[(m(!0),U(H,null,L(p.value,(a,c)=>(m(),U("div",{key:c,class:"col-sm-6"},[v(B,{label:a[2],modelValue:a[0],"onUpdate:modelValue":u=>a[0]=u,size:"large"},null,8,["label","modelValue","onUpdate:modelValue"]),t("div",null,[typeof a[1]=="boolean"?(m(),R(N,{key:0,class:"d-block mb-2",modelValue:a[1],"onUpdate:modelValue":u=>a[1]=u,"active-text":"Sí",disabled:!a[0],"inactive-text":"No"},null,8,["modelValue","onUpdate:modelValue","disabled"])):te("",!0)]),a[3]=="number"?(m(),R(F,{key:0,type:a[3],disabled:!a[0],modelValue:a[1],"onUpdate:modelValue":u=>a[1]=u},null,8,["type","disabled","modelValue","onUpdate:modelValue"])):te("",!0),a[3]=="text"?(m(),R(d,{key:1,modelValue:a[1],"onUpdate:modelValue":u=>a[1]=u},{default:b(()=>[(m(),U(H,null,L(["c1","c2","c3","c4"],u=>v(h,{key:u,label:u,value:u},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])):te("",!0)]))),128))]),e[15]||(e[15]=t("div",null,[t("h6")],-1)),v(y),t("div",Re,[t("div",We,[e[12]||(e[12]=t("h4",null,"Resultados simulación",-1)),Pe(t("h5",Ge,"(Calculando)",512),[[Se,J.value]]),t("h6",je," Cantidad de apuestas: "+s(f.value.length),1),t("div",null,[e[7]||(e[7]=t("h6",{class:"d-inline"},"Winrate:",-1)),k(" "+s(((se.value||0)*100).toFixed(2))+"% ("+s(w.value.wins)+"/"+s(f.value.length)+") ",1)]),t("div",null,[e[8]||(e[8]=t("h6",{class:"d-inline"},"Dinero Apostado:",-1)),k(" $ "+s(M.value),1)]),t("div",null,[e[9]||(e[9]=t("h6",{class:"d-inline"},"Dinero Obtenido:",-1)),k(" $ "+s(O.value),1)]),t("div",null,[e[10]||(e[10]=t("h6",{class:"d-inline"},"Ganancia neta:",-1)),k(" $ "+s((O.value-M.value).toFixed(2)),1)]),t("div",null,[e[11]||(e[11]=t("h6",{class:"d-inline"},"Beneficio:",-1)),k(" "+s((ae.value*100).toFixed(2))+"% ",1)])]),t("div",Je,[t("div",Ke,[v(C,{small:"",type:"primary",plain:"",onClick:_e},{default:b(()=>e[13]||(e[13]=[k("Simular por equipo")])),_:1})])])]),v(y),t("table",Xe,[e[14]||(e[14]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"#"),t("th",{scope:"col"},"Fecha"),t("th",{scope:"col"},"Match"),t("th",{scope:"col"},"Total"),t("th",{scope:"col"},"Bet"),t("th",{scope:"col"},"Apostado"),t("th",{scope:"col"},"Under Quota"),t("th",{scope:"col"},"Beneficio"),t("th",{scope:"col"},"Over Quota"),t("th",{scope:"col"},"Cuarto"),t("th",{scope:"col"},"Score"),t("th",{scope:"col"},"Cantidad de montañas"),t("th",{scope:"col"},"Diferencia ups/downs %"),t("th",{scope:"col"},"¿Primera apuesta?")])],-1)),t("tbody",null,[(m(!0),U(H,null,L(f.value,(a,c)=>(m(),U("tr",{class:Ne(a.match.hasOvertime?"table-danger":""),key:c},[t("th",Ye,s(c+1),1),t("td",null,s(ee(Qe)(a.match.createdAt)),1),t("td",null,[t("a",{href:`/matches/${a.match._id}`,target:"_blank"},s(`${a.match.teams[0].name} (${a.match.scoresDetailed.home}) - (${a.match.scoresDetailed.away}) ${a.match.teams[1].name}`),9,Ze)]),t("td",null,s(a.match.scoresDetailed.home+a.match.scoresDetailed.away),1),t("td",null,s(a.type)+" "+s(a.value)+" - "+s(a.quarter)+" "+s(oe(a)?"✅":"❌"),1),t("td",null,"S/. "+s(a.money),1),t("td",null,s(a.underQuota),1),t("td",null,s(oe(a)?`- S/. ${(a.money*(a.underQuota-1)).toFixed(2)}`:`- ${a.money}`),1),t("td",null,s(a.overQuota),1),t("td",null,s(a.quarter)+" "+s(ee(Ie)(a.millis)),1),t("td",null,s(a.scoresDetailed?`${a.scoresDetailed.home} - ${a.scoresDetailed.away}`:"Sin scores"),1),t("td",null,s(a.invertedConesLength),1),t("td",null,s(a.isFirstBet?"Sí":"No"),1),t("td",null,s(a.match.externalId),1)],2))),128))])])])])}}});export{st as default};
